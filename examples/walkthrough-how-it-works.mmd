%% Walkthrough: How the Walkthrough Skill Works
%% Description: The walkthrough skill turns a plain-English prompt into a Mermaid diagram of your codebase.
%% The AI agent reads the skill definition, launches parallel subagents to explore relevant code,
%% synthesizes findings, and outputs a self-contained .mmd file with rich node labels.

graph TD
  %% --- Subgroup: Trigger ---
  subgraph trigger["Trigger"]
    userPrompt(["<b>User Prompt</b><br/><i>The natural-language request that kicks off the walkthrough.<br/>Matches phrases like 'walkthrough', 'explain this flow', 'how does X work'.</i><br/><code>skills/walkthrough/skill.md:1-3</code>"])
  end

  %% --- Subgroup: Skill Configuration ---
  subgraph skill_config["Skill Configuration"]
    skillDefinition["<b>Skill Definition</b><br/><i>Defines the four-step workflow: understand scope,<br/>explore with subagents, choose diagram type, generate .mmd file.</i><br/><code>skills/walkthrough/skill.md</code>"]
  end

  %% --- Subgroup: Exploration Phase ---
  subgraph exploration["Exploration Phase"]
    scopeUnderstanding["<b>Scope Understanding</b><br/><i>Clarifies what the user wants explained and frames it<br/>as a mental model with 5-12 key concepts.</i><br/><code>skills/walkthrough/skill.md:25-35</code>"]
    parallelExploration["<b>Parallel Subagents</b><br/><i>Launches 2-4 Explore subagents via the Task tool.<br/>Each investigates one area and returns a structured report.</i><br/><code>skills/walkthrough/skill.md:37-88</code>"]
    synthesis["<b>Synthesis</b><br/><i>Combines subagent findings into node list, edge list,<br/>and subgraph groupings. Targets 5-12 nodes total.</i><br/><code>skills/walkthrough/skill.md:90-100</code>"]
  end

  %% --- Subgroup: Generation Phase ---
  subgraph generation["Generation Phase"]
    diagramSelection["<b>Diagram Selection</b><br/><i>Picks flowchart (graph TD/LR) for feature flows<br/>or ER diagram for database schemas.</i><br/><code>skills/walkthrough/skill.md:102-170</code>"]
    mermaidOutput["<b>Mermaid Output</b><br/><i>Writes a single .mmd file with rich node labels,<br/>subgraphs, classDef styles, and a TL;DR summary.</i><br/><code>skills/walkthrough/skill.md:172-210</code>"]
  end

  %% --- Subgroup: Result ---
  subgraph result["Result"]
    diagramFile(["<b>Diagram File</b><br/><i>A self-contained .mmd file that renders on GitHub,<br/>VS Code, Mermaid Live Editor, and other viewers.</i><br/><code>walkthrough-*.mmd</code>"])
  end

  %% --- Edges ---
  userPrompt -->|"triggers"| scopeUnderstanding
  skillDefinition -.->|"guides"| scopeUnderstanding
  scopeUnderstanding -->|"defines areas"| parallelExploration
  parallelExploration -->|"reports findings"| synthesis
  synthesis -->|"feeds concepts"| diagramSelection
  diagramSelection -->|"produces"| mermaidOutput
  mermaidOutput -->|"writes"| diagramFile

  %% --- Node type styles ---
  classDef component fill:#a855f7,stroke:#c084fc,color:#fff
  classDef composable fill:#7c3aed,stroke:#a78bfa,color:#fff
  classDef utility fill:#6d28d9,stroke:#8b5cf6,color:#fff
  classDef external fill:#525252,stroke:#737373,color:#fff
  classDef event fill:#d8b4fe,stroke:#e9d5ff,color:#000
  classDef data fill:#9333ea,stroke:#a855f7,color:#fff

  %% --- Node type assignments ---
  class userPrompt event
  class skillDefinition data
  class scopeUnderstanding utility
  class parallelExploration composable
  class synthesis utility
  class diagramSelection utility
  class mermaidOutput component
  class diagramFile component
